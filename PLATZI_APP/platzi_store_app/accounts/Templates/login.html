{% extends 'base.html' %}
{% load static %}

{% block title %}Iniciar Sesión - Platzi Store{% endblock %}

{% block content %}
<div class="login-container">
  <div class="login-card">
    <div class="login-header">
      <div class="store-icon">
        <i class="fas fa-shield-alt fa-3x"></i>
      </div>
      <h2 class="login-title">Acceso al Sistema</h2>
      <p class="login-subtitle">Inicia sesión en Platzi Store</p>
    </div>
    
    <!-- Mostrar mensajes de error o éxito -->
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show custom-alert" role="alert">
          <i class="fas fa-info-circle me-2"></i>{{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    {% endif %}

    <form method="post" novalidate class="login-form">
      {% csrf_token %}

      <!-- Campo Username -->
      <div class="form-group">
        <label for="{{ form.username.id_for_label }}" class="form-label">
          <i class="fas fa-user"></i> {{ form.username.label }}
        </label>
        <div class="input-container">
          <div class="input-icon">
            <i class="fas fa-user"></i>
          </div>
          {{ form.username }}
        </div>
        {% if form.username.errors %}
          <div class="field-errors">
            {% for error in form.username.errors %}
              <div class="error-message">
                <i class="fas fa-exclamation-circle"></i> {{ error }}
              </div>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <!-- Campo Password -->
      <div class="form-group">
        <label for="{{ form.password.id_for_label }}" class="form-label">
          <i class="fas fa-lock"></i> {{ form.password.label }}
        </label>
        <div class="input-container">
          <div class="input-icon">
            <i class="fas fa-lock"></i>
          </div>
          {{ form.password }}
          <button class="password-toggle" type="button" id="togglePassword">
            <i class="fas fa-eye" id="eyeIcon"></i>
          </button>
        </div>
        {% if form.password.errors %}
          <div class="field-errors">
            {% for error in form.password.errors %}
              <div class="error-message">
                <i class="fas fa-exclamation-circle"></i> {{ error }}
              </div>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <!-- Errores generales del formulario -->
      {% if form.non_field_errors %}
        <div class="alert alert-danger custom-alert">
          {% for error in form.non_field_errors %}
            <i class="fas fa-exclamation-triangle"></i> {{ error }}
          {% endfor %}
        </div>
      {% endif %}

      <!-- Checkbox "Recordarme" -->
      <div class="form-check-container">
        <label class="custom-checkbox">
          <input type="checkbox" id="rememberMe">
          <span class="checkmark"></span>
          Mantener sesión activa
        </label>
      </div>

      <!-- Botón de login -->
      <button type="submit" class="login-btn">
        <i class="fas fa-sign-in-alt"></i> Acceder al Sistema
      </button>

      <!-- Enlaces adicionales -->
      <div class="login-footer">
        <div class="register-prompt">
          <p>¿No tienes acceso?</p>
          <a href="{% url 'accounts:register' %}" class="register-link">
            <i class="fas fa-user-plus"></i> Crear nueva cuenta
          </a>
        </div>
      </div>
    </form>
  </div>
</div>

<style>
/* Estilos tech para el login */
.login-container {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #003d5c 100%);
  padding: 2rem 1rem;
  position: relative;
  overflow: hidden;
}

.login-container::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: 
    radial-gradient(circle at 20% 80%, rgba(0, 255, 136, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(0, 150, 255, 0.1) 0%, transparent 50%);
  pointer-events: none;
}

.login-card {
  background: rgba(26, 26, 46, 0.9);
  backdrop-filter: blur(20px);
  border-radius: 24px;
  padding: 3rem 2.5rem;
  width: 100%;
  max-width: 420px;
  border: 1px solid rgba(0, 255, 136, 0.3);
  box-shadow: 0 20px 40px rgba(0, 255, 136, 0.2);
  position: relative;
  z-index: 1;
}

.login-header {
  text-align: center;
  margin-bottom: 2.5rem;
}

.store-icon {
  color: #00ff88;
  margin-bottom: 1rem;
  filter: drop-shadow(0 0 20px rgba(0, 255, 136, 0.5));
}

.login-title {
  color: #ffffff;
  font-size: 2rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
  text-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
}

.login-subtitle {
  color: rgba(0, 255, 136, 0.8);
  font-size: 0.95rem;
  margin-bottom: 0;
}

/* Formulario */
.login-form {
  width: 100%;
}

.form-group {
  margin-bottom: 1.5rem;
}

.form-label {
  color: #00ff88;
  font-weight: 600;
  margin-bottom: 0.5rem;
  display: block;
  font-size: 0.9rem;
}

.input-container {
  position: relative;
  display: flex;
  align-items: center;
}

.input-icon {
  position: absolute;
  left: 15px;
  color: rgba(0, 255, 136, 0.7);
  z-index: 2;
  font-size: 0.9rem;
}

.form-control {
  width: 100%;
  padding: 15px 15px 15px 45px !important;
  border: 2px solid rgba(0, 255, 136, 0.3) !important;
  border-radius: 12px !important;
  background: rgba(26, 26, 46, 0.8) !important;
  backdrop-filter: blur(10px);
  color: #ffffff !important;
  font-size: 1rem;
  transition: all 0.3s ease;
}

.form-control::placeholder {
  color: rgba(255, 255, 255, 0.5) !important;
}

.form-control:focus {
  border-color: rgba(0, 255, 136, 0.8) !important;
  background: rgba(26, 26, 46, 0.9) !important;
  box-shadow: 0 0 0 3px rgba(0, 255, 136, 0.2) !important;
  outline: none;
  transform: translateY(-1px);
}

.password-toggle {
  position: absolute;
  right: 15px;
  background: none;
  border: none;
  color: rgba(0, 255, 136, 0.7);
  cursor: pointer;
  padding: 5px;
  z-index: 2;
  transition: color 0.3s ease;
}

.password-toggle:hover {
  color: #00ff88;
}

/* Errores */
.field-errors {
  margin-top: 0.5rem;
}

.error-message {
  color: #ff4757;
  font-size: 0.85rem;
  background: rgba(255, 71, 87, 0.1);
  padding: 0.5rem 0.75rem;
  border-radius: 8px;
  border-left: 3px solid #ff4757;
  margin-bottom: 0.25rem;
}

.custom-alert {
  background: rgba(26, 26, 46, 0.8) !important;
  border: 1px solid rgba(0, 255, 136, 0.2) !important;
  border-radius: 12px !important;
  color: #ffffff !important;
  padding: 1rem;
  margin-bottom: 1.5rem;
}

/* Checkbox personalizado */
.form-check-container {
  margin-bottom: 2rem;
}

.custom-checkbox {
  display: flex;
  align-items: center;
  color: rgba(255, 255, 255, 0.9);
  cursor: pointer;
  font-size: 0.9rem;
  user-select: none;
}

.custom-checkbox input[type="checkbox"] {
  display: none;
}

.checkmark {
  height: 20px;
  width: 20px;
  background: rgba(26, 26, 46, 0.8);
  border: 2px solid rgba(0, 255, 136, 0.3);
  border-radius: 4px;
  margin-right: 0.75rem;
  position: relative;
  transition: all 0.3s ease;
}

.custom-checkbox:hover .checkmark {
  background: rgba(26, 26, 46, 0.9);
  border-color: rgba(0, 255, 136, 0.6);
}

.custom-checkbox input[type="checkbox"]:checked + .checkmark {
  background: rgba(0, 255, 136, 0.8);
  border-color: #00ff88;
}

.checkmark:after {
  content: "";
  position: absolute;
  display: none;
  left: 6px;
  top: 2px;
  width: 5px;
  height: 10px;
  border: solid #1a1a2e;
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

.custom-checkbox input[type="checkbox"]:checked + .checkmark:after {
  display: block;
}

/* Botón de login */
.login-btn {
  width: 100%;
  padding: 16px;
  background: linear-gradient(135deg, #00ff88 0%, #0096ff 100%);
  border: none;
  border-radius: 12px;
  color: #1a1a2e;
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-bottom: 2rem;
  box-shadow: 0 8px 20px rgba(0, 255, 136, 0.3);
}

.login-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 25px rgba(0, 255, 136, 0.4);
  background: linear-gradient(135deg, #00e676 0%, #0088cc 100%);
}

.login-btn:active {
  transform: translateY(0);
}

/* Footer del login */
.login-footer {
  text-align: center;
}

.register-prompt {
  background: rgba(26, 26, 46, 0.6);
  border-radius: 16px;
  padding: 1.5rem;
  border: 1px solid rgba(0, 255, 136, 0.2);
}

.register-prompt p {
  color: rgba(255, 255, 255, 0.8);
  margin-bottom: 1rem;
  font-size: 0.9rem;
}

.register-link {
  display: inline-block;
  background: rgba(26, 26, 46, 0.8);
  color: #00ff88 !important;
  text-decoration: none !important;
  padding: 12px 24px;
  border-radius: 10px;
  border: 2px solid rgba(0, 255, 136, 0.3);
  font-weight: 600;
  transition: all 0.3s ease;
  font-size: 0.9rem;
}

.register-link:hover {
  background: rgba(26, 26, 46, 0.9);
  border-color: rgba(0, 255, 136, 0.6);
  transform: translateY(-1px);
  color: #00ff88 !important;
}

/* Responsive */
@media (max-width: 576px) {
  .login-container {
    padding: 1rem;
  }
  
  .login-card {
    padding: 2rem 1.5rem;
    border-radius: 20px;
  }
  
  .login-title {
    font-size: 1.6rem;
  }
  
  .form-control {
    padding: 12px 12px 12px 40px !important;
  }
  
  .input-icon {
    left: 12px;
  }
  
  .password-toggle {
    right: 12px;
  }
}

@media (max-width: 768px) {
  .login-container {
    align-items: flex-start;
    padding-top: 2rem;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Toggle password visibility
  const togglePassword = document.getElementById('togglePassword');
  const passwordField = document.getElementById('{{ form.password.id_for_label }}');
  const eyeIcon = document.getElementById('eyeIcon');
  
  if (togglePassword && passwordField) {
    togglePassword.addEventListener('click', function() {
      const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';
      passwordField.setAttribute('type', type);
      
      eyeIcon.className = type === 'password' ? 'fas fa-eye' : 'fas fa-eye-slash';
    });
  }
  
  // Auto-focus first empty field
  const firstEmptyField = document.querySelector('.form-control:not([value]):not(:disabled)');
  if (firstEmptyField) {
    firstEmptyField.focus();
  }

  // Animación de entrada
  const loginCard = document.querySelector('.login-card');
  loginCard.style.opacity = '0';
  loginCard.style.transform = 'translateY(30px)';
  
  setTimeout(() => {
    loginCard.style.transition = 'all 0.6s ease';
    loginCard.style.opacity = '1';
    loginCard.style.transform = 'translateY(0)';
  }, 100);
});
</script>
{% endblock %}